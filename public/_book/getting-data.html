<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Course 8: Getting Data | Instructor Resources for Chromebook Data Science</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Course 8: Getting Data | Instructor Resources for Chromebook Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Course 8: Getting Data | Instructor Resources for Chromebook Data Science" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Aboozar Hadavand">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="visualization.html">
<link rel="next" href="analysis.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://www.clouddatascience.org/">Go back to the Homepage</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What is this book</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i>Course 0: Introduction to Chromebook Data Science</a></li>
<li class="chapter" data-level="" data-path="chromebook.html"><a href="chromebook.html"><i class="fa fa-check"></i>Course 1: How to Use a Chromebook</a></li>
<li class="chapter" data-level="" data-path="google.html"><a href="google.html"><i class="fa fa-check"></i>Course 2: Google and the Cloud</a><ul>
<li class="chapter" data-level="" data-path="google.html"><a href="google.html#exercise-1-sharing-google-docs-with-others"><i class="fa fa-check"></i>Exercise 1: Sharing Google Docs with Others</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="organizing.html"><a href="organizing.html"><i class="fa fa-check"></i>Course 3: Organizing Data Science Projects</a><ul>
<li class="chapter" data-level="" data-path="organizing.html"><a href="organizing.html#exercise-1-replicating-a-google-doc-as-rmd"><i class="fa fa-check"></i>Exercise 1: Replicating a Google doc as Rmd</a></li>
<li class="chapter" data-level="" data-path="organizing.html"><a href="organizing.html#exercise-1-creating-a-new-project-and-the-workflow"><i class="fa fa-check"></i>Exercise 1: Creating a New Project and the Workflow</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="version-control.html"><a href="version-control.html"><i class="fa fa-check"></i>Course 4: Version Control</a></li>
<li class="chapter" data-level="" data-path="intro-r.html"><a href="intro-r.html"><i class="fa fa-check"></i>Course 5: Introduction to R</a><ul>
<li class="chapter" data-level="" data-path="intro-r.html"><a href="intro-r.html#exercise-1-installing-and-uninstalling-packages"><i class="fa fa-check"></i>Exercise 1: Installing and Uninstalling Packages</a></li>
<li class="chapter" data-level="" data-path="intro-r.html"><a href="intro-r.html#exercise-2-using-the-script-editor"><i class="fa fa-check"></i>Exercise 2: Using the script editor</a></li>
<li class="chapter" data-level="" data-path="intro-r.html"><a href="intro-r.html#exercise-xx-basic-commands-in-r"><i class="fa fa-check"></i>Exercise XX: Basic Commands in R</a></li>
<li class="chapter" data-level="" data-path="intro-r.html"><a href="intro-r.html#exercise-xx-creating-a-data-frame"><i class="fa fa-check"></i>Exercise XX: Creating a Data Frame</a></li>
<li class="chapter" data-level="" data-path="intro-r.html"><a href="intro-r.html#exercise-xx-creating-lists-in-r"><i class="fa fa-check"></i>Exercise XX: Creating Lists in R</a></li>
<li class="chapter" data-level="" data-path="intro-r.html"><a href="intro-r.html#exercise-xx-missing-values-in-r"><i class="fa fa-check"></i>Exercise XX: Missing Values in R</a></li>
<li class="chapter" data-level="" data-path="intro-r.html"><a href="intro-r.html#exercise-4-reverse-a-string-function"><i class="fa fa-check"></i>Exercise 4: Reverse a String Function</a></li>
<li class="chapter" data-level="" data-path="intro-r.html"><a href="intro-r.html#exercise-5-other-short-exercises"><i class="fa fa-check"></i>Exercise 5: Other Short Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tidying.html"><a href="tidying.html"><i class="fa fa-check"></i>Course 6: Data Tidying</a><ul>
<li class="chapter" data-level="" data-path="tidying.html"><a href="tidying.html#exercise-1-tidying-nba-finals-data"><i class="fa fa-check"></i>Exercise 1: Tidying NBA Finals Data</a></li>
<li class="chapter" data-level="" data-path="tidying.html"><a href="tidying.html#exercise-2-calculating-age-based-on-birthdate"><i class="fa fa-check"></i>Exercise 2: Calculating Age Based on Birthdate</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i>Course 7: Data Visualization</a><ul>
<li class="chapter" data-level="" data-path="visualization.html"><a href="visualization.html#exercise-1-visualizing-nba-finals-data"><i class="fa fa-check"></i>Exercise 1: Visualizing NBA Finals Data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="getting-data.html"><a href="getting-data.html"><i class="fa fa-check"></i>Course 8: Getting Data</a><ul>
<li class="chapter" data-level="" data-path="getting-data.html"><a href="getting-data.html#exercise-1-saving-a-data-frame-as-an-rds-file"><i class="fa fa-check"></i>Exercise 1: Saving a data frame as an rds file</a></li>
<li class="chapter" data-level="" data-path="getting-data.html"><a href="getting-data.html#exercise-2-scraping-imdb-data"><i class="fa fa-check"></i>Exercise 2: Scraping IMDB data</a></li>
<li class="chapter" data-level="" data-path="getting-data.html"><a href="getting-data.html#exercise-3-scraping-nba-data-from-espn.com"><i class="fa fa-check"></i>Exercise 3: Scraping NBA data from ESPN.com</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i>Course 9: Data Analysis</a></li>
<li class="chapter" data-level="" data-path="communication.html"><a href="communication.html"><i class="fa fa-check"></i>Course 10: Written and Oral Communication in Data Science</a></li>
<li class="chapter" data-level="" data-path="getting-jobs.html"><a href="getting-jobs.html"><i class="fa fa-check"></i>Course 11: Getting a Job in Data Science</a></li>
<li class="chapter" data-level="" data-path="random.html"><a href="random.html"><i class="fa fa-check"></i>Course 11: Random Stuff</a><ul>
<li class="chapter" data-level="" data-path="random.html"><a href="random.html#classroom-activity-1"><i class="fa fa-check"></i>Classroom activity 1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Instructor Resources for Chromebook Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="getting-data" class="section level1 unnumbered">
<h1>Course 8: Getting Data</h1>
<div id="exercise-1-saving-a-data-frame-as-an-rds-file" class="section level2 unnumbered">
<h2>Exercise 1: Saving a data frame as an rds file</h2>
<div class="tip">
<p>Level: Easy</p>
</div>
<p>In this exercise, your student will learn how to save a data frame as a rds or rda file. Before, this exercise remind your students about the best practices of web scraping. Too much scraping at higher rates will put pressure on the website servers. There is a great article <a href="https://www.scrapehero.com/how-to-prevent-getting-blacklisted-while-scraping/">here</a> about the best practices of web scraping.</p>
<p>First ask your students to load the dataset <strong>mtcars</strong> and save it to an object called <code>data</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span>mtcars
<span class="kw">head</span>(data)</code></pre>
<pre><code>##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
<p>Now ask them to simply save the data frame <code>data</code> as an rds file with the same name. They should use a code similar to</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">saveRDS</span>(data, <span class="dt">file =</span> <span class="st">&quot;data.rds&quot;</span>)</code></pre>
<p>You can also ask them to save the data frame as an rda file:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(data, <span class="dt">file=</span><span class="st">&quot;data.rda&quot;</span>)</code></pre>
</div>
<div id="exercise-2-scraping-imdb-data" class="section level2 unnumbered">
<h2>Exercise 2: Scraping IMDB data</h2>
<div class="tip">
<p>Level: Difficult</p>
</div>
<p>In this exercise, your students will practice working with the package <strong>rvest</strong> and scraping data from the web. We’ll more specifically scrape top 250 movies from the website IMDB. This information can be found on this <a href="https://www.imdb.com/search/title?genres=drama&amp;groups=top_250&amp;sort=user_rating">link</a>. Ask your students to load the packages <strong>rvest</strong>, <strong>tidyverse</strong> and <strong>stringr</strong>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest)</code></pre>
<pre><code>## Loading required package: xml2</code></pre>
<pre><code>## 
## Attaching package: &#39;rvest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     pluck</code></pre>
<pre><code>## The following object is masked from &#39;package:readr&#39;:
## 
##     guess_encoding</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(stringr)</code></pre>
<p>The first step in using the rvest package and scraping data from the web is to read the content of the webpage we’re interested in. For this, we use the function <code>read_html()</code> from the package <strong>rvest</strong>. The address above only contains the first 50 movies but we can use similar process for the pages that come after.</p>
<pre class="sourceCode r"><code class="sourceCode r">imdb &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;https://www.imdb.com/search/title?genres=drama&amp;groups=top_250&amp;sort=user_rating&quot;</span>)</code></pre>
<p>The object <code>imdb</code> contains all the html content of the page in the form of an <strong>xml</strong> document that contains the <em>head</em> and the <em>body</em> of the page. Now, here is the important part. Let’s say we would like to make a data frame that has 4 columns. The first column is the name of the movies, the second column is their ratings, the third column is their genres, and the last column is the year the movies are made. We want to make this data frame for the top 50 movies. For scraping different components of a webpage we need to know the CSS <em>selector</em> of the specific part of the html file they’re scraping.</p>
<p>We are going to use a Chrome Extension called SelectorGadget. SelectorGadget is an open source tool that makes CSS selector generation and discovery on complicated sites a breeze. They should install the Chrome Extension. They can download SelectorGadget Chrome Extension <a href="https://chrome.google.com/webstore/detail/selectorgadget/mhjhnkcfbdhnjickkkdbjoemdmbfginb?hl=en">here</a>. They can learn more about the SelectorGadget in this <a href="https://vimeo.com/52055686">video</a>.</p>
<p>So how do we use the SelectorGadget to find the movie title? After installing the extension, ask your students to drag the bookmarklet to their bookmark bar, then go to any page and launch it. A box will open in the bottom right of the website. Ask them to click the title of the first movie on the list which is “The Shawshank Redemption”. Without clicking, SelectorGadget will show an orange box around the element under which it says <code>h3 a</code>. This is the CSS selector we need. Now how do we use <strong>rvest</strong> to choose the selector and read the information with that CSS selector?</p>
<div class="figure">
<img src="images/selector_gadget.png" alt="SelectorGadget" />
<p class="caption">SelectorGadget</p>
</div>
<p>Your students will have to use the function <code>html_nodes()</code> in order to read information with that style. We will use the selector that we found using SelectorGadget and use the function <code>html_text("h3 a")</code> to convert everything into text. Here’s what we need to do in order to read the titles of the movies.</p>
<pre class="sourceCode r"><code class="sourceCode r">titles &lt;-<span class="st"> </span>imdb <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;h3 a&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_text</span>()
titles</code></pre>
<pre><code>##  [1] &quot;The Shawshank Redemption&quot;                         
##  [2] &quot;The Godfather&quot;                                    
##  [3] &quot;The Dark Knight&quot;                                  
##  [4] &quot;The Godfather: Part II&quot;                           
##  [5] &quot;The Lord of the Rings: The Return of the King&quot;    
##  [6] &quot;Pulp Fiction&quot;                                     
##  [7] &quot;Schindler&#39;s List&quot;                                 
##  [8] &quot;12 Angry Men&quot;                                     
##  [9] &quot;Fight Club&quot;                                       
## [10] &quot;The Lord of the Rings: The Fellowship of the Ring&quot;
## [11] &quot;Forrest Gump&quot;                                     
## [12] &quot;The Lord of the Rings: The Two Towers&quot;            
## [13] &quot;Goodfellas&quot;                                       
## [14] &quot;One Flew Over the Cuckoo&#39;s Nest&quot;                  
## [15] &quot;Seven Samurai&quot;                                    
## [16] &quot;Interstellar&quot;                                     
## [17] &quot;City of God&quot;                                      
## [18] &quot;Saving Private Ryan&quot;                              
## [19] &quot;The Green Mile&quot;                                   
## [20] &quot;Life Is Beautiful&quot;                                
## [21] &quot;Se7en&quot;                                            
## [22] &quot;Léon: The Professional&quot;                           
## [23] &quot;The Silence of the Lambs&quot;                         
## [24] &quot;It&#39;s a Wonderful Life&quot;                            
## [25] &quot;Dangal&quot;                                           
## [26] &quot;Whiplash&quot;                                         
## [27] &quot;The Intouchables&quot;                                 
## [28] &quot;The Prestige&quot;                                     
## [29] &quot;The Departed&quot;                                     
## [30] &quot;The Pianist&quot;                                      
## [31] &quot;Gladiator&quot;                                        
## [32] &quot;American History X&quot;                               
## [33] &quot;The Lion King&quot;                                    
## [34] &quot;Cinema Paradiso&quot;                                  
## [35] &quot;Grave of the Fireflies&quot;                           
## [36] &quot;Apocalypse Now&quot;                                   
## [37] &quot;Casablanca&quot;                                       
## [38] &quot;The Great Dictator&quot;                               
## [39] &quot;Modern Times&quot;                                     
## [40] &quot;City Lights&quot;                                      
## [41] &quot;Your Name.&quot;                                       
## [42] &quot;Django Unchained&quot;                                 
## [43] &quot;3 Idiots&quot;                                         
## [44] &quot;Taare Zameen Par&quot;                                 
## [45] &quot;Babam ve Oglum&quot;                                   
## [46] &quot;The Lives of Others&quot;                              
## [47] &quot;Oldeuboi&quot;                                         
## [48] &quot;American Beauty&quot;                                  
## [49] &quot;Braveheart&quot;                                       
## [50] &quot;Once Upon a Time in America&quot;                      
## [51] &quot; &quot;                                                
## [52] &quot; &quot;                                                
## [53] &quot; &quot;                                                
## [54] &quot; &quot;                                                
## [55] &quot; &quot;</code></pre>
<p>The object <code>titles</code> now contains the name of the movies. It should have 50 elements but it has 55. If they check the object they will realize that the last 5 elements are empty. So we should get rid of them. This is what we should do.</p>
<pre class="sourceCode r"><code class="sourceCode r">titles &lt;-<span class="st"> </span>titles[titles <span class="op">!=</span><span class="st"> &quot; &quot;</span>]</code></pre>
<p>Note that the object is a vector. We will create separate vectors for ratings, genres, and years and then will at the end create a data frame that contains all the 4 vectors. Now, we will use the SelectorGadget to find the CSS selector for years. The selector for years is <code>h3 span</code>. So similar to</p>
<pre class="sourceCode r"><code class="sourceCode r">years &lt;-<span class="st"> </span>imdb <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">html_nodes</span>(<span class="st">&quot;h3 span&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">html_text</span>()
years</code></pre>
<pre><code>##   [1] &quot;1.&quot;     &quot;(1994)&quot; &quot;2.&quot;     &quot;(1972)&quot; &quot;3.&quot;     &quot;(2008)&quot; &quot;4.&quot;    
##   [8] &quot;(1974)&quot; &quot;5.&quot;     &quot;(2003)&quot; &quot;6.&quot;     &quot;(1994)&quot; &quot;7.&quot;     &quot;(1993)&quot;
##  [15] &quot;8.&quot;     &quot;(1957)&quot; &quot;9.&quot;     &quot;(1999)&quot; &quot;10.&quot;    &quot;(2001)&quot; &quot;11.&quot;   
##  [22] &quot;(1994)&quot; &quot;12.&quot;    &quot;(2002)&quot; &quot;13.&quot;    &quot;(1990)&quot; &quot;14.&quot;    &quot;(1975)&quot;
##  [29] &quot;15.&quot;    &quot;(1954)&quot; &quot;16.&quot;    &quot;(2014)&quot; &quot;17.&quot;    &quot;(2002)&quot; &quot;18.&quot;   
##  [36] &quot;(1998)&quot; &quot;19.&quot;    &quot;(1999)&quot; &quot;20.&quot;    &quot;(1997)&quot; &quot;21.&quot;    &quot;(1995)&quot;
##  [43] &quot;22.&quot;    &quot;(1994)&quot; &quot;23.&quot;    &quot;(1991)&quot; &quot;24.&quot;    &quot;(1946)&quot; &quot;25.&quot;   
##  [50] &quot;(2016)&quot; &quot;26.&quot;    &quot;(2014)&quot; &quot;27.&quot;    &quot;(2011)&quot; &quot;28.&quot;    &quot;(2006)&quot;
##  [57] &quot;29.&quot;    &quot;(2006)&quot; &quot;30.&quot;    &quot;(2002)&quot; &quot;31.&quot;    &quot;(2000)&quot; &quot;32.&quot;   
##  [64] &quot;(1998)&quot; &quot;33.&quot;    &quot;(1994)&quot; &quot;34.&quot;    &quot;(1988)&quot; &quot;35.&quot;    &quot;(1988)&quot;
##  [71] &quot;36.&quot;    &quot;(1979)&quot; &quot;37.&quot;    &quot;(1942)&quot; &quot;38.&quot;    &quot;(1940)&quot; &quot;39.&quot;   
##  [78] &quot;(1936)&quot; &quot;40.&quot;    &quot;(1931)&quot; &quot;41.&quot;    &quot;(2016)&quot; &quot;42.&quot;    &quot;(2012)&quot;
##  [85] &quot;43.&quot;    &quot;(2009)&quot; &quot;44.&quot;    &quot;(2007)&quot; &quot;45.&quot;    &quot;(2005)&quot; &quot;46.&quot;   
##  [92] &quot;(2006)&quot; &quot;47.&quot;    &quot;(2003)&quot; &quot;48.&quot;    &quot;(1999)&quot; &quot;49.&quot;    &quot;(1995)&quot;
##  [99] &quot;50.&quot;    &quot;(1984)&quot;</code></pre>
<p>If they look at the object <code>years</code>, they will notice the peculiar content. The years are in parentheses and there are some other numbers as well. Then their next task is to write code that will only keep inside the parentheses. This is a bit tricky so feel free to give the code below. The function <code>str_match_all()</code> and the regex (regular expression) inside it will return everything inside the parentheses but since the output is in the form of a list, they can use the function <code>unlist()</code> to convert the output to a vector. Finally to convert the vector to numbers (since the outuput is the years movies are made and we want them to be numbers) we use the function <code>as.numeric()</code> as they have used many times.</p>
<pre class="sourceCode r"><code class="sourceCode r">years &lt;-<span class="st"> </span>years <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">str_match_all</span>(<span class="st">&quot;(?&lt;=</span><span class="ch">\\</span><span class="st">().+?(?=</span><span class="ch">\\</span><span class="st">))&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">as.numeric</span>()</code></pre>
<p>Object <code>years</code> should now look like a clean vector of the years movies are made.</p>
<pre><code>##  [1] 1994 1972 2008 1974 2003 1994 1993 1957 1999 2001 1994 2002 1990 1975
## [15] 1954 2014 2002 1998 1999 1997 1995 1994 1991 1946 2016 2014 2011 2006
## [29] 2006 2002 2000 1998 1994 1988 1988 1979 1942 1940 1936 1931 2016 2012
## [43] 2009 2007 2005 2006 2003 1999 1995 1984</code></pre>
<p>The following code will scrape genres and ratings from the website.</p>
<pre class="sourceCode r"><code class="sourceCode r">genre =<span class="st"> </span>imdb <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">html_nodes</span>(<span class="st">&quot;.genre&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="co"># getting rid of the &quot;\n&quot; in the strings</span>
<span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;[</span><span class="ch">\r\n</span><span class="st">]&quot;</span> , <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="co"># getting rid of the extra spaces in both ends of the strings</span>
<span class="st">    </span><span class="kw">str_trim</span>(<span class="dt">side =</span> <span class="kw">c</span>(<span class="st">&quot;both&quot;</span>))

ratings =<span class="st"> </span>imdb <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">html_nodes</span>(<span class="st">&quot;.mode-advanced strong , .runtime , .genre&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">as.numeric</span>()</code></pre>
<pre><code>## Warning in function_list[[k]](value): NAs introduced by coercion</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># There are some empty elements so we get rid of them here</span>
ratings &lt;-<span class="st"> </span>ratings[<span class="op">!</span><span class="kw">is.na</span>(ratings)]</code></pre>
<p>Now that all the data is downloaded, ask your students to combine all the vectors in a data frame called <code>imdb_df</code>. They should know to use the <code>data.frame()</code> function in order to do that.</p>
<pre class="sourceCode r"><code class="sourceCode r">imdb_df =<span class="st"> </span><span class="kw">data.frame</span>(titles, years, genre, ratings, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
<span class="kw">head</span>(imdb_df)</code></pre>
<pre><code>##                                          titles years
## 1                      The Shawshank Redemption  1994
## 2                                 The Godfather  1972
## 3                               The Dark Knight  2008
## 4                        The Godfather: Part II  1974
## 5 The Lord of the Rings: The Return of the King  2003
## 6                                  Pulp Fiction  1994
##                       genre ratings
## 1                     Drama     9.3
## 2              Crime, Drama     9.2
## 3      Action, Crime, Drama     9.0
## 4              Crime, Drama     9.0
## 5 Adventure, Drama, Fantasy     8.9
## 6              Crime, Drama     8.9</code></pre>
<p>They can continue doing this for the rest of the top 250 movies.</p>
</div>
<div id="exercise-3-scraping-nba-data-from-espn.com" class="section level2 unnumbered">
<h2>Exercise 3: Scraping NBA data from ESPN.com</h2>
<div class="tip">
<p>Level: Difficult</p>
</div>
<p>In this exercise, your students will work on another scraping exercise. This time NBA standings from the espn.com website. The link to the webpage we want to scrape is <a href="http://www.espn.com/nba/standings">here</a>. Note that by the time you will see this exercise, the content of the website might have changed so be aware of that. The changes on the website will likely change the html nodes we need to use. This is the table we would like to scrape the table below:</p>
<div class="figure">
<img src="images/nba_espn.png" alt="NBA standings on ESPN.com" />
<p class="caption">NBA standings on ESPN.com</p>
</div>
<p>Again, we’re gonna use the package <strong>rvest</strong> for this exercise. If you want to familiarize your students with the basic commands, look at the previous exercise. First, let’s use the <code>read_html()</code> function to scrape the entire webpage.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest)
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(stringr)
nba =<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;http://www.espn.com/nba/standings&quot;</span>)</code></pre>
<p>Now, we need to know the css selector for each column. Again, let’s use the <strong>SelectorGadget</strong> extension on the Chrome browswer to find the CSS selectors. More information on the <strong>SelectorGadget</strong> extension can be found in the previous exercise.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## first we will create an empty list</span>
column &lt;-<span class="st"> </span><span class="kw">list</span>()
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">13</span>){
    node =<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;.Table2__td:nth-child(&quot;</span>,i,<span class="st">&quot;) .stat-cell&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
    a &lt;-<span class="st"> </span>nba <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">        </span><span class="kw">html_nodes</span>(node) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">html_text</span>() 
    column[[i]] &lt;-<span class="st"> </span>a
}
<span class="kw">names</span>(column) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;W&quot;</span>, <span class="st">&quot;L&quot;</span>, <span class="st">&quot;PCT&quot;</span>, <span class="st">&quot;GB&quot;</span>, <span class="st">&quot;HOME&quot;</span>, <span class="st">&quot;AWAY&quot;</span>, <span class="st">&quot;DIV&quot;</span>, <span class="st">&quot;CONF&quot;</span>, <span class="st">&quot;PPG&quot;</span>, <span class="st">&quot;OPP PPG&quot;</span>, <span class="st">&quot;DIFF&quot;</span>, <span class="st">&quot;STRK&quot;</span>, <span class="st">&quot;L10&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(column, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(column,<span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="visualization.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["cbds_instructors.pdf", "cbds_instructors.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
